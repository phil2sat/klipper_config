# This is a Klipper configuration for TronXY X5SA, with CXY-V6
# motherboard.

#            === FLASHING WITH STOCK BOOTLOADER ===
# You should make firmware for STM32F103 with bootloader offset
# at 0x8008800 (Chitu v6 Bootloader) and serial (on USART1 PA10/PA9)
# communication.

# Use "./scripts/update_chitu.py ./out/klipper.bin ./out/update.cbd"
# after make to generate update.cbd.  Put `update.cbd` onto SD card,
# and reboot the printer.  It will be automatically installed, and you
# will be able to update it this way.

[include macros/*.cfg]
[include configs/*.cfg]
[include menus/*.cfg]

[save_variables]
filename: ~/klipper_config/save_variables.cfg

[mcu]
serial: /dev/serial0
baud: 250000
restart_method: command

[mcu rpi]
serial: /tmp/klipper_host_mcu

[printer]
kinematics: corexy
max_velocity: 600	# 750 if pi zero could do faster, over if chitu could do faster, gnaaa
max_accel: 3500
max_accel_to_decel: 1750
max_z_velocity: 35
max_z_accel: 20

[stepper_x]
step_pin: PE5
dir_pin: !PE6
enable_pin: !PC13
microsteps: 32
rotation_distance: 40
endstop_pin: !PG10
position_endstop: 0
position_min: 0
position_max: 310
homing_speed: 50
homing_retract_dist: 10
second_homing_speed: 10.0

[stepper_y]
step_pin: PE2
dir_pin: !PE3
enable_pin: !PE4
microsteps: 32
rotation_distance: 40
endstop_pin: !PA12
position_endstop: 0	
position_min: -20	
position_max: 302
homing_retract_dist: 15
homing_speed: 50.0
second_homing_speed: 10.0

[stepper_z]
step_pin: PB9
dir_pin: PE0
enable_pin: !PE1
microsteps: 32
rotation_distance: 8
#endstop_pin: !PG9
endstop_pin: probe:z_virtual_endstop
position_max: 390
position_min: -20
#position_endstop = -1.645

[extruder]
step_pin: PB4
dir_pin: !PB5
enable_pin: !PB8
microsteps: 32
#rotation_distance: 35.520  # Titan Extruder Clone Rotation Distance
#rotation_distance: 22.478   # Bondtech Extruder Clone Gear Ratio
#gear_ratio: 66:22           # Bondtech Extruder Clone Gear Ratio
rotation_distance: 7.700 #from ender 5 plus BMG
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: PG12
sensor_type: PT1000
sensor_pin: PA1
# [extruder]
# control = pid
# pid_kp = 21.402
# pid_ki = 1.762
# pid_kd = 65.009
min_temp: 0
max_temp: 300
min_extrude_temp: 170
#max_extrude_only_distance: 2550
#max_extrude_only_velocity: 100
max_extrude_cross_section: 0.8
max_extrude_only_velocity: 150.0
max_extrude_only_accel: 4000.0
pressure_advance = 0.02

[heater_bed]
heater_pin: PG11
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PA0
control: pid
min_temp: 0
max_temp: 130
pid_kp = 70.102
pid_ki = 1.568
pid_kd = 783.385

# Offset also kleiner/negativ ist hoeher, groesser/positiv ist niedriger

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 21.402
#*# pid_ki = 1.762
#*# pid_kd = 65.009
#*#
#*# [probe]
#*# z_offset = 1.065
#*#
#*# [input_shaper]
#*# shaper_type_x = ei
#*# shaper_freq_x = 57.2
#*# shaper_type_y = zv
#*# shaper_freq_y = 39.8
