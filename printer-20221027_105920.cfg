# This is a Klipper configuration for TronXY X5SA, with CXY-V6
# motherboard.

#            === FLASHING WITH STOCK BOOTLOADER ===
# You should make firmware for STM32F103 with bootloader offset
# at 0x8008800 (Chitu v6 Bootloader) and serial (on USART1 PA10/PA9)
# communication.

# Use "./scripts/update_chitu.py ./out/klipper.bin ./out/update.cbd"
# after make to generate update.cbd.  Put `update.cbd` onto SD card,
# and reboot the printer.  It will be automatically installed, and you
# will be able to update it this way.

[include macros/*.cfg]
[include configs/*.cfg]
[include menus/*.cfg]

[save_variables]
filename: ~/klipper_config/save_variables.cfg

[mcu]
serial: /dev/serial0
baud: 250000
restart_method: command

[mcu rpi]
serial: /tmp/klipper_host_mcu

[printer]
kinematics: corexy
max_velocity: 600	# 750 if pi zero could do faster, over if chitu could do faster, gnaaa
max_accel: 3500
max_accel_to_decel: 1750
max_z_velocity: 35
max_z_accel: 20

[stepper_x]
step_pin: PE5
dir_pin: !PE6
enable_pin: !PC13
microsteps: 32
rotation_distance: 40
endstop_pin: !PG10
position_endstop: 0
position_min: 0
position_max: 310
homing_speed: 50
homing_retract_dist: 10
second_homing_speed: 10.0

[stepper_y]
step_pin: PE2
dir_pin: !PE3
enable_pin: !PE4
microsteps: 32
rotation_distance: 40
endstop_pin: !PA12
position_endstop: 0	
position_min: -20	
position_max: 302
homing_retract_dist: 15
homing_speed: 50.0
second_homing_speed: 10.0

[stepper_z]
step_pin: PB9
dir_pin: PE0
enable_pin: !PE1
microsteps: 32
rotation_distance: 8
#endstop_pin: !PG9
endstop_pin: probe:z_virtual_endstop
position_max: 390
position_min: -20
#position_endstop = -1.645

[extruder]
step_pin: PB4
dir_pin: !PB5
enable_pin: !PB8
microsteps: 32
#rotation_distance: 35.520  # Titan Extruder Clone Rotation Distance
#rotation_distance: 22.478   # Bondtech Extruder Clone Gear Ratio
#gear_ratio: 66:22           # Bondtech Extruder Clone Gear Ratio
rotation_distance: 7.700 #from ender 5 plus BMG
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: PG12
sensor_type: PT1000
sensor_pin: PA1
# [extruder]
# control = pid
# pid_kp = 21.402
# pid_ki = 1.762
# pid_kd = 65.009
min_temp: 0
max_temp: 300
min_extrude_temp: 170
#max_extrude_only_distance: 2550
#max_extrude_only_velocity: 100
max_extrude_cross_section: 0.8
max_extrude_only_velocity: 150.0
max_extrude_only_accel: 4000.0
#pressure_advance = 0.02
pressure_advance = 0.163

[heater_bed]
heater_pin: PG11
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PA0
control: pid
min_temp: 0
max_temp: 130
pid_kp = 70.102
pid_ki = 1.568
pid_kd = 783.385

# Offset also kleiner/negativ ist hoeher, groesser/positiv ist niedriger

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 21.402
#*# pid_ki = 1.762
#*# pid_kd = 65.009
#*#
#*# [probe]
#*# z_offset = 0.700
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	1.098750, 1.096250, 1.085000, 1.083750, 1.112500, 1.150000, 1.141250, 1.097500, 1.062500, 1.065000, 1.052500, 1.058750, 1.052500, 1.038750, 1.028750, 1.028750, 1.030000, 1.036250, 1.103750, 1.151250, 1.142500, 1.061250, 1.035000, 1.035000
#*# 	1.093750, 1.101250, 1.093750, 1.095000, 1.091250, 1.091250, 1.086250, 1.083750, 1.082500, 1.080000, 1.072500, 1.070000, 1.070000, 1.070000, 1.067500, 1.068750, 1.061250, 1.066250, 1.067500, 1.066250, 1.068750, 1.063750, 1.063750, 1.068750
#*# 	1.126250, 1.125000, 1.121250, 1.111250, 1.112500, 1.112500, 1.111250, 1.110000, 1.103750, 1.106250, 1.100000, 1.095000, 1.093750, 1.090000, 1.082500, 1.077500, 1.077500, 1.080000, 1.075000, 1.078750, 1.080000, 1.072500, 1.085000, 1.077500
#*# 	1.136250, 1.133750, 1.128750, 1.128750, 1.126250, 1.125000, 1.125000, 1.122500, 1.120000, 1.118750, 1.116250, 1.111250, 1.112500, 1.111250, 1.113750, 1.116250, 1.108750, 1.106250, 1.108750, 1.110000, 1.102500, 1.101250, 1.107500, 1.096250
#*# 	1.161250, 1.155000, 1.158750, 1.152500, 1.150000, 1.157500, 1.148750, 1.146250, 1.148750, 1.145000, 1.142500, 1.142500, 1.148750, 1.138750, 1.133750, 1.131250, 1.128750, 1.125000, 1.126250, 1.130000, 1.118750, 1.113750, 1.116250, 1.107500
#*# 	1.157500, 1.158750, 1.158750, 1.152500, 1.157500, 1.158750, 1.165000, 1.162500, 1.162500, 1.161250, 1.160000, 1.160000, 1.162500, 1.157500, 1.155000, 1.150000, 1.152500, 1.151250, 1.146250, 1.147500, 1.142500, 1.131250, 1.130000, 1.125000
#*# 	1.168750, 1.172500, 1.168750, 1.171250, 1.168750, 1.177500, 1.181250, 1.176250, 1.178750, 1.178750, 1.173750, 1.180000, 1.177500, 1.177500, 1.170000, 1.168750, 1.165000, 1.167500, 1.162500, 1.156250, 1.170000, 1.147500, 1.135000, 1.133750
#*# 	1.167500, 1.165000, 1.170000, 1.173750, 1.173750, 1.181250, 1.181250, 1.183750, 1.190000, 1.185000, 1.192500, 1.191250, 1.192500, 1.187500, 1.187500, 1.185000, 1.185000, 1.181250, 1.176250, 1.176250, 1.187500, 1.156250, 1.156250, 1.142500
#*# 	1.176250, 1.175000, 1.176250, 1.176250, 1.180000, 1.183750, 1.198750, 1.191250, 1.196250, 1.193750, 1.201250, 1.202500, 1.207500, 1.202500, 1.195000, 1.200000, 1.195000, 1.187500, 1.183750, 1.180000, 1.176250, 1.163750, 1.153750, 1.147500
#*# 	1.158750, 1.165000, 1.167500, 1.163750, 1.171250, 1.171250, 1.177500, 1.182500, 1.196250, 1.196250, 1.213750, 1.205000, 1.215000, 1.215000, 1.212500, 1.205000, 1.207500, 1.206250, 1.203750, 1.197500, 1.190000, 1.170000, 1.166250, 0.942500
#*# 	1.161250, 1.162500, 1.162500, 1.166250, 1.163750, 1.172500, 1.180000, 1.183750, 1.195000, 1.195000, 1.198750, 1.201250, 1.212500, 1.207500, 1.210000, 1.206250, 1.208750, 1.201250, 1.197500, 1.191250, 1.181250, 1.185000, 1.155000, 1.151250
#*# 	1.136250, 1.138750, 1.141250, 1.140000, 1.147500, 1.158750, 1.163750, 1.177500, 1.185000, 1.187500, 1.191250, 1.203750, 1.210000, 1.208750, 1.212500, 1.213750, 1.210000, 1.207500, 1.205000, 1.196250, 1.192500, 1.177500, 1.171250, 1.162500
#*# 	1.137500, 1.138750, 1.140000, 1.142500, 1.150000, 1.153750, 1.162500, 1.173750, 1.181250, 1.183750, 1.192500, 1.193750, 1.208750, 1.206250, 1.208750, 1.205000, 1.205000, 1.202500, 1.198750, 1.187500, 1.182500, 1.165000, 1.162500, 1.145000
#*# 	1.121250, 1.123750, 1.122500, 1.123750, 1.133750, 1.131250, 1.142500, 1.155000, 1.165000, 1.175000, 1.181250, 1.186250, 1.198750, 1.196250, 1.201250, 1.208750, 1.206250, 1.196250, 1.196250, 1.193750, 1.178750, 1.167500, 1.162500, 1.146250
#*# 	1.117500, 1.117500, 1.121250, 1.120000, 1.121250, 1.127500, 1.137500, 1.145000, 1.157500, 1.165000, 1.170000, 1.177500, 1.187500, 1.183750, 1.195000, 1.190000, 1.190000, 1.185000, 1.177500, 1.177500, 1.171250, 1.156250, 1.151250, 1.137500
#*# 	1.093750, 1.098750, 1.097500, 1.096250, 1.101250, 1.110000, 1.110000, 1.120000, 1.132500, 1.138750, 1.142500, 1.155000, 1.168750, 1.171250, 1.175000, 1.185000, 1.176250, 1.180000, 1.171250, 1.175000, 1.162500, 1.152500, 1.146250, 1.132500
#*# 	1.081250, 1.083750, 1.080000, 1.085000, 1.083750, 1.088750, 1.101250, 1.108750, 1.118750, 1.125000, 1.135000, 1.143750, 1.152500, 1.151250, 1.157500, 1.156250, 1.160000, 1.166250, 1.155000, 1.152500, 1.147500, 1.138750, 1.132500, 1.118750
#*# 	1.063750, 1.062500, 1.060000, 1.055000, 1.061250, 1.068750, 1.080000, 1.085000, 1.092500, 1.102500, 1.107500, 1.121250, 1.130000, 1.133750, 1.137500, 1.137500, 1.140000, 1.140000, 1.141250, 1.141250, 1.133750, 1.123750, 1.121250, 1.111250
#*# 	1.053750, 1.048750, 1.045000, 1.042500, 1.041250, 1.046250, 1.052500, 1.060000, 1.071250, 1.075000, 1.085000, 1.096250, 1.103750, 1.107500, 1.111250, 1.116250, 1.118750, 1.117500, 1.122500, 1.111250, 1.108750, 1.097500, 1.101250, 1.082500
#*# 	1.022500, 1.018750, 1.010000, 1.002500, 1.006250, 1.013750, 1.022500, 1.027500, 1.038750, 1.045000, 1.056250, 1.087500, 1.075000, 1.083750, 1.087500, 1.088750, 1.095000, 1.091250, 1.092500, 1.091250, 1.088750, 1.076250, 1.072500, 1.060000
#*# 	1.008750, 1.003750, 0.995000, 1.005000, 0.987500, 0.993750, 1.001250, 1.010000, 1.013750, 1.020000, 1.033750, 1.041250, 1.051250, 1.052500, 1.070000, 1.062500, 1.067500, 1.073750, 1.071250, 1.072500, 1.063750, 1.061250, 1.055000, 1.045000
#*# 	1.001250, 0.987500, 0.973750, 0.960000, 0.970000, 0.963750, 0.973750, 0.977500, 0.992500, 1.003750, 1.012500, 1.023750, 1.035000, 1.036250, 1.045000, 1.050000, 1.051250, 1.047500, 1.055000, 1.050000, 1.040000, 1.033750, 1.028750, 0.970000
#*# 	0.985000, 0.967500, 0.953750, 0.941250, 0.943750, 0.948750, 0.956250, 0.961250, 0.975000, 0.985000, 0.992500, 1.007500, 1.017500, 1.016250, 1.027500, 1.028750, 1.033750, 1.032500, 1.032500, 1.028750, 1.027500, 1.017500, 1.012500, -0.301250
#*# 	0.925000, 0.907500, 0.888750, 0.878750, 0.876250, 0.883750, 0.885000, 0.900000, 0.916250, 0.930000, 0.938750, 0.951250, 0.965000, 0.970000, 0.980000, 0.990000, 0.992500, 0.987500, 0.988750, 0.986250, 0.977500, 0.973750, 0.967500, 0.955000
#*# x_count = 24
#*# y_count = 24
#*# mesh_x_pps = 5
#*# mesh_y_pps = 5
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 20.0
#*# max_x = 266.79
#*# min_y = 20.0
#*# max_y = 279.9
#*#
#*# [input_shaper]
#*# shaper_type_x = ei
#*# shaper_freq_x = 57.2
#*# shaper_type_y = zv
#*# shaper_freq_y = 39.8
